<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title><%= title || "ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" %></title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body { font-family: "Segoe UI","Noto Sans JP",sans-serif; background:#f5f7fa; margin:0; padding:0; }
    header { display:flex; justify-content:space-between; align-items:center; background:#343a40; color:white; padding:15px 20px; }
    header img { width:40px; cursor:pointer; transition:.3s; }
    header img:hover { opacity:0.7; }
    main { max-width:1100px; margin:auto; padding:25px; }
    section { background:white; border-radius:10px; padding:20px; margin-bottom:25px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    h2 { border-left:5px solid #0078d4; padding-left:10px; color:#0078d4; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#0078d4; color:white; }
    tr:nth-child(even){background:#f9f9f9;}
    button { background:#0078d4; color:white; border:none; border-radius:5px; padding:6px 12px; cursor:pointer; }
    button:hover { background:#005fa3; }
    .btn-danger { background:#dc3545; }
  </style>
</head>
<body>
<header>
  <h1>ğŸ§‘â€ğŸ’¼ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
  <img src="/images/logout.png" alt="logout" onclick="logout()">
</header>

<main>
  <!-- ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† -->
  <section>
    <h2>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
    <form method="POST" action="/admin/addUser">
      <input type="text" name="id" placeholder="ID" required>
      <input type="text" name="name" placeholder="æ°å" required>
      <select name="role" required>
        <option value="student">ç”Ÿå¾’</option>
        <option value="teacher">æ‹…ä»»</option>
        <option value="admin">ç®¡ç†è€…</option>
      </select>
      <select name="grade"><option>1å¹´</option><option>2å¹´</option><option>3å¹´</option></select>
      <select name="class_name"><option>A</option><option>B</option><option>C</option></select>
      <input type="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
      <button>è¿½åŠ  / æ›´æ–°</button>
    </form>
    <table>
      <thead><tr><th>ID</th><th>åå‰</th><th>å½¹å‰²</th><th>å­¦å¹´</th><th>ã‚¯ãƒ©ã‚¹</th><th>æ“ä½œ</th></tr></thead>
      <tbody>
        <% users.forEach(u=>{ %>
          <tr>
            <td><%= u.id %></td>
            <td><%= u.name %></td>
            <td><%= u.role %></td>
            <td><%= u.grade %></td>
            <td><%= u.class_name %></td>
            <td>
              <form method="POST" action="/admin/deleteUser/<%= u.id %>" onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                <button class="btn-danger">å‰Šé™¤</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </section>

  <!-- ğŸ“‹ æå‡ºãƒ‡ãƒ¼ã‚¿ -->
  <section>
    <h2>ğŸ“‹ æå‡ºãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h2>
    <form method="POST" action="/admin/reset" onsubmit="return confirm('æå‡ºå±¥æ­´ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')">
      <button class="btn-danger">æå‡ºãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
    </form>
    <table>
      <thead><tr><th>ID</th><th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th><th>æ—¥ä»˜</th><th>ä½“èª¿</th><th>ãƒ¡ãƒ³ã‚¿ãƒ«</th><th>çŠ¶æ…‹</th></tr></thead>
      <tbody>
        <% entries.forEach(e=>{ %>
          <tr>
            <td><%= e.id %></td>
            <td><%= e.username %></td>
            <td><%= e.date %></td>
            <td><%= e.condition %></td>
            <td><%= e.mental %></td>
            <td><%= e.status %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </section>

  <!-- ğŸ“Š çµ±è¨ˆã‚°ãƒ©ãƒ• -->
  <section>
    <h2>ğŸ“Š å¹³å‡å€¤</h2>
    <canvas id="chart" style="max-width:500px;height:220px;margin:auto;"></canvas>
    <p>ç·æå‡ºï¼š<%= totalEntries %> ä»¶ã€€æœªèª­ï¼š<%= unreadCount %> ä»¶ã€€æ—¢èª­ï¼š<%= readCount %> ä»¶</p>
  </section>

  <!-- ğŸ•“ ãƒ­ã‚° -->
  <section>
    <h2>ğŸ•“ æ“ä½œãƒ­ã‚°</h2>
    <form method="POST" action="/admin/logs/clear" onsubmit="return confirm('ãƒ­ã‚°ã‚’å…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
      <button class="btn-danger">ãƒ­ã‚°å…¨å‰Šé™¤</button>
    </form>
    <table>
      <thead><tr><th>ID</th><th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th><th>æ“ä½œ</th><th>æ—¥æ™‚</th></tr></thead>
      <tbody>
        <% logs.forEach(l=>{ %>
          <tr>
            <td><%= l.id %></td>
            <td><%= l.user %></td>
            <td><%= l.action %></td>
            <td><%= l.time %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </section>
</main>

<script>
new Chart(document.getElementById('chart'), {
  type: 'bar',
  data: {
    labels: ['ä½“èª¿', 'ãƒ¡ãƒ³ã‚¿ãƒ«'],
    datasets: [{ data: [<%= avgCondition %>, <%= avgMental %>], backgroundColor: ['#0078d4', '#f28e2b'] }]
  },
  options: { scales: { y: { beginAtZero: true, max: 5 } }, plugins: { legend: { display: false } } }
});
function logout() {
  if (confirm("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) window.location.href = "/logout";
}
</script>
</body>
</html>
